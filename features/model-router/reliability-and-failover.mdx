---
title: "稳定性与故障切换"
description: "自动重试、通道切换与流式兜底，降低异常与限流影响"
---

## 核心能力（简述）
- 遇到 429 或上游异常时，平台自动重试并切换已开通且健康的通道。
- 流式调用提供心跳与异常兜底，异常时自动关闭连接，避免悬挂。
- 动态限流护栏在高并发时削峰，保护主路由与任务型接口。

## 如何使用
- 使用前：在模型目录确认该令牌可见多个通道（如未配置，请联系管理员）。  
- 调用时：正常使用 `/v1`、`/claude/v1/messages`、`/gemini/:version/models/:model` 或任务型接口，无需额外参数即可享受自动重试与切换。  
- 放量前：先小流量验证；批量或长流式场景可分批提交，降低瞬时并发。  

## 请求示例（流式聊天）
<CodeGroup>
```ts TypeScript
await fetch("https://api.platform.com/v1/chat/completions", {
  method: "POST",
  headers: {
    "Authorization": "Bearer sk-demo123",
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    model: "gpt-4o-mini",
    messages: [{ role: "user", content: "请给我一段新品发布会开场文案" }],
    stream: true
  })
});
```
```py Python
import requests

resp = requests.post(
    "https://api.platform.com/v1/chat/completions",
    headers={
        "Authorization": "Bearer sk-demo123",
        "Content-Type": "application/json",
    },
    json={
        "model": "gpt-4o-mini",
        "messages": [{"role": "user", "content": "请给我一段新品发布会开场文案"}],
        "stream": True,
    },
)
```
```bash cURL
curl https://api.platform.com/v1/chat/completions \
  -H "Authorization: Bearer sk-demo123" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4o-mini",
    "messages": [{"role": "user", "content": "请给我一段新品发布会开场文案"}],
    "stream": true
  }'
```
</CodeGroup>

## 使用提醒
- 自动重试与通道切换依赖已开通且健康的备用通道；未开通则无法切换。
- 限流护栏生效时可能降低速率，建议分批或错峰调用。
- 流式异常时平台会关闭连接，你可按需在客户端补充重试逻辑。
